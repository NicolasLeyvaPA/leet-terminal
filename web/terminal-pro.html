<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leet Quantum Terminal Pro - Prediction Markets Analytics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * { font-family: "Inter", sans-serif; }
    .mono { font-family: "JetBrains Mono", monospace; }

    body {
      background: #0a0a0a;
      overflow: auto;
    }

    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #0f0f0f;
      --bg-tertiary: #161616;
      --bg-panel: #111111;
      --border: #1e1e1e;
      --border-light: #2a2a2a;
      --text-primary: #e5e5e5;
      --text-secondary: #888888;
      --text-muted: #555555;
      --accent-orange: #ff6b00;
      --accent-green: #00d26a;
      --accent-red: #ff3b3b;
      --accent-blue: #0088ff;
      --accent-yellow: #ffd000;
      --accent-purple: #a855f7;
      --accent-cyan: #06b6d4;
    }

    .terminal-panel {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 3px;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      background: linear-gradient(180deg, #1a1a1a 0%, #121212 100%);
      border-bottom: 1px solid var(--border);
      padding: 5px 10px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--accent-orange);
      flex-shrink: 0;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .data-row {
      display: flex;
      justify-content: space-between;
      padding: 3px 0;
      border-bottom: 1px solid #141414;
      font-size: 11px;
    }

    .data-label { color: var(--text-secondary); }
    .data-value { color: var(--text-primary); font-weight: 500; }
    .positive { color: var(--accent-green); }
    .negative { color: var(--accent-red); }
    .neutral { color: var(--accent-yellow); }
    .highlight { color: var(--accent-orange); }
    .info { color: var(--accent-blue); }

    .ticker-tape {
      background: #080808;
      border-bottom: 1px solid var(--border);
      overflow: hidden;
      white-space: nowrap;
    }

    .ticker-content {
      display: inline-block;
      animation: ticker 90s linear infinite;
    }

    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .cmd-input {
      background: #080808;
      border: 1px solid #222;
      color: #ff6b00;
      font-family: "JetBrains Mono", monospace;
    }

    .cmd-input:focus {
      outline: none;
      border-color: #ff6b00;
      box-shadow: 0 0 0 1px rgba(255, 107, 0, 0.2);
    }

    .btn {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      color: #888;
      font-size: 10px;
      padding: 4px 10px;
      transition: all 0.15s;
      cursor: pointer;
    }

    .btn:hover {
      background: #222;
      color: #fff;
      border-color: #333;
    }

    .btn.active, .btn.primary {
      background: #ff6b00;
      color: #000;
      border-color: #ff6b00;
    }

    .btn.success { background: #00d26a; color: #000; border-color: #00d26a; }
    .btn.danger { background: #ff3b3b; color: #000; border-color: #ff3b3b; }

    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 2px; }
    ::-webkit-scrollbar-thumb:hover { background: #333; }

    .confluence-bar {
      height: 6px;
      background: #1a1a1a;
      border-radius: 3px;
      overflow: hidden;
    }

    .confluence-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .workspace-tab {
      padding: 6px 14px;
      font-size: 10px;
      background: transparent;
      border: none;
      color: #555;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .workspace-tab:hover { color: #888; }
    .workspace-tab.active { color: #ff6b00; border-bottom-color: #ff6b00; }

    .tag {
      display: inline-block;
      padding: 2px 6px;
      font-size: 9px;
      border-radius: 2px;
      text-transform: uppercase;
    }

    .tag-buy { background: rgba(0, 210, 106, 0.15); color: #00d26a; }
    .tag-sell { background: rgba(255, 59, 59, 0.15); color: #ff3b3b; }
    .tag-hold { background: rgba(136, 136, 136, 0.15); color: #888; }
    .tag-platform { background: rgba(255, 107, 0, 0.15); color: #ff6b00; }
    .tag-category { background: rgba(0, 136, 255, 0.15); color: #0088ff; }

    .shap-bar {
      height: 12px;
      display: flex;
      align-items: center;
    }

    .shap-negative {
      background: linear-gradient(90deg, transparent, rgba(255, 59, 59, 0.6));
      margin-right: 2px;
    }

    .shap-positive {
      background: linear-gradient(90deg, rgba(0, 210, 106, 0.6), transparent);
      margin-left: 2px;
    }

    .news-item {
      border-left: 2px solid transparent;
      transition: all 0.2s;
    }

    .news-item:hover {
      background: #161616;
      border-left-color: #ff6b00;
    }

    .news-positive { border-left-color: #00d26a; }
    .news-negative { border-left-color: #ff3b3b; }
    .news-neutral { border-left-color: #ffd000; }

    .heatmap-cell {
      transition: all 0.2s;
      cursor: pointer;
    }

    .heatmap-cell:hover {
      transform: scale(1.05);
      z-index: 10;
    }

    .quantum-glow {
      animation: quantumPulse 2s ease-in-out infinite;
    }

    @keyframes quantumPulse {
      0%, 100% { box-shadow: 0 0 5px rgba(168, 85, 247, 0.3); }
      50% { box-shadow: 0 0 15px rgba(168, 85, 247, 0.6); }
    }

    .flash-update {
      animation: flash 0.5s;
    }

    @keyframes flash {
      0%, 100% { background: transparent; }
      50% { background: rgba(255, 107, 0, 0.1); }
    }

    /* DRAG HANDLES */
    .split-handle-x {
      flex: 0 0 4px;
      cursor: col-resize;
      background: #0c0c0c;
      border-left: 1px solid #1f1f1f;
      border-right: 1px solid #1f1f1f;
    }
    .split-handle-x:hover {
      background: #202020;
    }

    .split-handle-y {
      flex: 0 0 6px;
      cursor: row-resize;
      background: #0c0c0c;
      border-top: 1px solid #1f1f1f;
      border-bottom: 1px solid #1f1f1f;
    }
    .split-handle-y:hover {
      background: #202020;
    }
  </style>
</head>
<body class="text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    /* ===================== DATA ===================== */

    const MARKETS_DATABASE = [
      {
        id: "poly-btc-150k",
        ticker: "BTC150K",
        platform: "Polymarket",
        question: "Will Bitcoin exceed $150,000 before July 2025?",
        category: "Crypto",
        subcategory: "Bitcoin",
        market_prob: 0.34,
        model_prob: 0.42,
        prev_prob: 0.32,
        volume_24h: 245000,
        volume_total: 12500000,
        liquidity: 890000,
        spread: 0.012,
        open_interest: 3200000,
        trades_24h: 1847,
        end_date: "2025-07-01",
        created: "2024-01-15",
        resolution_source: "CoinGecko price at 23:59 UTC",
        price_history: generatePriceHistory(0.34, 90),
        orderbook: generateOrderbook(0.34),
        factors: {
          orderbook_imbalance: {
            value: 0.72,
            contribution: 0.18,
            direction: "bullish",
            desc: "Strong buy-side depth imbalance",
          },
          price_momentum: {
            value: 0.65,
            contribution: 0.12,
            direction: "bullish",
            desc: "14-day momentum positive",
          },
          volume_trend: {
            value: 0.58,
            contribution: 0.08,
            direction: "bullish",
            desc: "Increasing volume pattern",
          },
          news_sentiment: {
            value: 0.71,
            contribution: 0.15,
            direction: "bullish",
            desc: "Positive news flow last 48h",
          },
          social_sentiment: {
            value: 0.62,
            contribution: 0.09,
            direction: "bullish",
            desc: "Twitter sentiment +45%",
          },
          smart_money: {
            value: 0.75,
            contribution: 0.14,
            direction: "bullish",
            desc: "Large wallet accumulation",
          },
          historical_pattern: {
            value: 0.55,
            contribution: 0.06,
            direction: "neutral",
            desc: "Similar events 55% resolution rate",
          },
          time_decay: {
            value: 0.48,
            contribution: -0.04,
            direction: "bearish",
            desc: "Theta decay as expiry approaches",
          },
          liquidity_score: {
            value: 0.82,
            contribution: 0.08,
            direction: "bullish",
            desc: "High liquidity, low slippage",
          },
          model_confidence: {
            value: 0.78,
            contribution: 0.14,
            direction: "bullish",
            desc: "High model agreement (4/4)",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.44, weight: 0.35, confidence: 0.82 },
          xgboost: { prob: 0.41, weight: 0.3, confidence: 0.79 },
          logistic: { prob: 0.39, weight: 0.2, confidence: 0.71 },
          bayesian: { prob: 0.43, weight: 0.15, confidence: 0.75 },
        },
        greeks: { delta: 0.42, gamma: 0.08, theta: -0.002, vega: 0.15, rho: 0.03 },
        correlations: { ETH5K: 0.85, FEDQ1: -0.32, SPY: 0.42, GOLD: -0.15 },
        related_news: [
          {
            time: "2h ago",
            title: "Bitcoin ETF sees record inflows",
            sentiment: 0.8,
            source: "Bloomberg",
          },
          {
            time: "5h ago",
            title: "MicroStrategy adds 2,100 BTC",
            sentiment: 0.7,
            source: "Reuters",
          },
          {
            time: "1d ago",
            title: "Fed signals dovish stance",
            sentiment: 0.6,
            source: "CNBC",
          },
        ],
      },
      {
        id: "poly-eth-5k",
        ticker: "ETH5K",
        platform: "Polymarket",
        question: "Will Ethereum exceed $5,000 in 2025?",
        category: "Crypto",
        subcategory: "Ethereum",
        market_prob: 0.45,
        model_prob: 0.53,
        prev_prob: 0.43,
        volume_24h: 320000,
        volume_total: 14200000,
        liquidity: 1100000,
        spread: 0.01,
        open_interest: 3800000,
        trades_24h: 2156,
        end_date: "2025-12-31",
        created: "2024-01-01",
        resolution_source: "CoinGecko price",
        price_history: generatePriceHistory(0.45, 90),
        orderbook: generateOrderbook(0.45),
        factors: {
          orderbook_imbalance: {
            value: 0.58,
            contribution: 0.1,
            direction: "bullish",
            desc: "Moderate buy pressure",
          },
          price_momentum: {
            value: 0.52,
            contribution: 0.05,
            direction: "neutral",
            desc: "Consolidating pattern",
          },
          volume_trend: {
            value: 0.61,
            contribution: 0.08,
            direction: "bullish",
            desc: "Volume uptick detected",
          },
          news_sentiment: {
            value: 0.65,
            contribution: 0.11,
            direction: "bullish",
            desc: "ETF narrative building",
          },
          social_sentiment: {
            value: 0.58,
            contribution: 0.07,
            direction: "bullish",
            desc: "Developer activity up",
          },
          smart_money: {
            value: 0.68,
            contribution: 0.12,
            direction: "bullish",
            desc: "Staking deposits increasing",
          },
          historical_pattern: {
            value: 0.52,
            contribution: 0.04,
            direction: "neutral",
            desc: "Mixed historical performance",
          },
          time_decay: {
            value: 0.55,
            contribution: 0.02,
            direction: "neutral",
            desc: "Long time to expiry",
          },
          liquidity_score: {
            value: 0.88,
            contribution: 0.09,
            direction: "bullish",
            desc: "Excellent liquidity",
          },
          model_confidence: {
            value: 0.72,
            contribution: 0.1,
            direction: "bullish",
            desc: "Good model agreement (3/4)",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.55, weight: 0.35, confidence: 0.78 },
          xgboost: { prob: 0.52, weight: 0.3, confidence: 0.74 },
          logistic: { prob: 0.49, weight: 0.2, confidence: 0.68 },
          bayesian: { prob: 0.54, weight: 0.15, confidence: 0.71 },
        },
        greeks: { delta: 0.53, gamma: 0.09, theta: -0.001, vega: 0.16, rho: 0.02 },
        correlations: { BTC150K: 0.85, SOL200: 0.75, SPY: 0.38, ARKK: 0.52 },
        related_news: [
          {
            time: "3h ago",
            title: "Ethereum L2 TVL hits new ATH",
            sentiment: 0.75,
            source: "DeFi Pulse",
          },
          {
            time: "8h ago",
            title: "Vitalik discusses scaling roadmap",
            sentiment: 0.6,
            source: "Twitter",
          },
        ],
      },
      {
        id: "kalshi-fed-q1",
        ticker: "FEDQ1",
        platform: "Kalshi",
        question: "Will the Fed cut rates in Q1 2025?",
        category: "Economics",
        subcategory: "Monetary Policy",
        market_prob: 0.62,
        model_prob: 0.53,
        prev_prob: 0.65,
        volume_24h: 189000,
        volume_total: 8900000,
        liquidity: 1200000,
        spread: 0.008,
        open_interest: 2100000,
        trades_24h: 2341,
        end_date: "2025-04-01",
        created: "2024-06-01",
        resolution_source: "Federal Reserve announcement",
        price_history: generatePriceHistory(0.62, 90),
        orderbook: generateOrderbook(0.62),
        factors: {
          orderbook_imbalance: {
            value: 0.42,
            contribution: -0.08,
            direction: "bearish",
            desc: "Sell pressure emerging",
          },
          price_momentum: {
            value: 0.38,
            contribution: -0.12,
            direction: "bearish",
            desc: "Downtrend last 14 days",
          },
          volume_trend: {
            value: 0.55,
            contribution: 0.02,
            direction: "neutral",
            desc: "Stable volume",
          },
          news_sentiment: {
            value: 0.35,
            contribution: -0.15,
            direction: "bearish",
            desc: "Hawkish Fed commentary",
          },
          social_sentiment: {
            value: 0.42,
            contribution: -0.06,
            direction: "bearish",
            desc: "Market skeptical",
          },
          smart_money: {
            value: 0.38,
            contribution: -0.1,
            direction: "bearish",
            desc: "Bond traders selling",
          },
          historical_pattern: {
            value: 0.45,
            contribution: -0.04,
            direction: "bearish",
            desc: "Cuts rare with strong labor",
          },
          time_decay: {
            value: 0.52,
            contribution: 0.01,
            direction: "neutral",
            desc: "Moderate time to expiry",
          },
          liquidity_score: {
            value: 0.92,
            contribution: 0.06,
            direction: "bullish",
            desc: "Very high liquidity",
          },
          model_confidence: {
            value: 0.81,
            contribution: -0.12,
            direction: "bearish",
            desc: "Strong model agreement on SELL",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.51, weight: 0.35, confidence: 0.84 },
          xgboost: { prob: 0.54, weight: 0.3, confidence: 0.81 },
          logistic: { prob: 0.55, weight: 0.2, confidence: 0.76 },
          bayesian: { prob: 0.52, weight: 0.15, confidence: 0.79 },
        },
        greeks: { delta: -0.53, gamma: 0.06, theta: -0.003, vega: 0.12, rho: -0.08 },
        correlations: { BTC150K: -0.32, SPY: 0.55, TLT: 0.72, GOLD: 0.35 },
        related_news: [
          {
            time: "1h ago",
            title: 'Powell: "No rush to cut rates"',
            sentiment: -0.7,
            source: "Fed",
          },
          {
            time: "6h ago",
            title: "CPI comes in above expectations",
            sentiment: -0.6,
            source: "BLS",
          },
          {
            time: "1d ago",
            title: "Jobs report shows resilient labor market",
            sentiment: -0.5,
            source: "Reuters",
          },
        ],
      },
      {
        id: "poly-spacex",
        ticker: "SXSHIP",
        platform: "Polymarket",
        question: "Will SpaceX Starship reach orbit by June 2025?",
        category: "Science",
        subcategory: "Space",
        market_prob: 0.75,
        model_prob: 0.84,
        prev_prob: 0.72,
        volume_24h: 120000,
        volume_total: 5600000,
        liquidity: 450000,
        spread: 0.015,
        open_interest: 1800000,
        trades_24h: 892,
        end_date: "2025-06-30",
        created: "2024-03-01",
        resolution_source: "Official SpaceX announcement + FAA confirmation",
        price_history: generatePriceHistory(0.75, 90),
        orderbook: generateOrderbook(0.75),
        factors: {
          orderbook_imbalance: {
            value: 0.78,
            contribution: 0.14,
            direction: "bullish",
            desc: "Strong bid support",
          },
          price_momentum: {
            value: 0.82,
            contribution: 0.16,
            direction: "bullish",
            desc: "Sustained uptrend",
          },
          volume_trend: {
            value: 0.68,
            contribution: 0.08,
            direction: "bullish",
            desc: "Growing interest",
          },
          news_sentiment: {
            value: 0.85,
            contribution: 0.18,
            direction: "bullish",
            desc: "Very positive coverage",
          },
          social_sentiment: {
            value: 0.88,
            contribution: 0.12,
            direction: "bullish",
            desc: "Elon tweets driving optimism",
          },
          smart_money: {
            value: 0.72,
            contribution: 0.1,
            direction: "bullish",
            desc: "Insider confidence high",
          },
          historical_pattern: {
            value: 0.65,
            contribution: 0.06,
            direction: "bullish",
            desc: "SpaceX track record strong",
          },
          time_decay: {
            value: 0.58,
            contribution: 0.02,
            direction: "neutral",
            desc: "Moderate time remaining",
          },
          liquidity_score: {
            value: 0.65,
            contribution: 0.04,
            direction: "neutral",
            desc: "Adequate liquidity",
          },
          model_confidence: {
            value: 0.91,
            contribution: 0.18,
            direction: "bullish",
            desc: "Very high model consensus",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.86, weight: 0.35, confidence: 0.92 },
          xgboost: { prob: 0.83, weight: 0.3, confidence: 0.89 },
          logistic: { prob: 0.81, weight: 0.2, confidence: 0.84 },
          bayesian: { prob: 0.85, weight: 0.15, confidence: 0.88 },
        },
        greeks: { delta: 0.84, gamma: 0.04, theta: -0.001, vega: 0.08, rho: 0.01 },
        correlations: { TSLA: 0.45, ARKK: 0.38, GPT5: 0.25, BA: 0.22 },
        related_news: [
          {
            time: "4h ago",
            title: "Starship Flight 7 achieves all objectives",
            sentiment: 0.9,
            source: "SpaceX",
          },
          {
            time: "2d ago",
            title: "FAA grants expanded launch license",
            sentiment: 0.8,
            source: "FAA",
          },
        ],
      },
      {
        id: "poly-gpt5",
        ticker: "GPT5",
        platform: "Polymarket",
        question: "Will OpenAI release GPT-5 before July 2025?",
        category: "Tech",
        subcategory: "AI",
        market_prob: 0.55,
        model_prob: 0.64,
        prev_prob: 0.52,
        volume_24h: 150000,
        volume_total: 7200000,
        liquidity: 680000,
        spread: 0.011,
        open_interest: 2400000,
        trades_24h: 1456,
        end_date: "2025-07-01",
        created: "2024-02-15",
        resolution_source: "Official OpenAI announcement",
        price_history: generatePriceHistory(0.55, 90),
        orderbook: generateOrderbook(0.55),
        factors: {
          orderbook_imbalance: {
            value: 0.62,
            contribution: 0.1,
            direction: "bullish",
            desc: "Buyers stepping in",
          },
          price_momentum: {
            value: 0.58,
            contribution: 0.06,
            direction: "bullish",
            desc: "Gradual uptrend",
          },
          volume_trend: {
            value: 0.65,
            contribution: 0.08,
            direction: "bullish",
            desc: "Volume increasing",
          },
          news_sentiment: {
            value: 0.72,
            contribution: 0.14,
            direction: "bullish",
            desc: "Sam Altman hints at progress",
          },
          social_sentiment: {
            value: 0.68,
            contribution: 0.1,
            direction: "bullish",
            desc: "Industry buzz growing",
          },
          smart_money: {
            value: 0.65,
            contribution: 0.09,
            direction: "bullish",
            desc: "VC activity suggests readiness",
          },
          historical_pattern: {
            value: 0.55,
            contribution: 0.04,
            direction: "neutral",
            desc: "OpenAI often delays",
          },
          time_decay: {
            value: 0.52,
            contribution: 0.01,
            direction: "neutral",
            desc: "Moderate time left",
          },
          liquidity_score: {
            value: 0.78,
            contribution: 0.06,
            direction: "bullish",
            desc: "Good liquidity",
          },
          model_confidence: {
            value: 0.75,
            contribution: 0.11,
            direction: "bullish",
            desc: "Good model agreement",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.66, weight: 0.35, confidence: 0.78 },
          xgboost: { prob: 0.63, weight: 0.3, confidence: 0.75 },
          logistic: { prob: 0.61, weight: 0.2, confidence: 0.7 },
          bayesian: { prob: 0.65, weight: 0.15, confidence: 0.73 },
        },
        greeks: { delta: 0.64, gamma: 0.07, theta: -0.002, vega: 0.14, rho: 0.02 },
        correlations: { MSFT: 0.52, NVDA: 0.61, GOOGL: 0.48, SXSHIP: 0.25 },
        related_news: [
          {
            time: "6h ago",
            title: "OpenAI hiring spree continues",
            sentiment: 0.65,
            source: "LinkedIn",
          },
          {
            time: "1d ago",
            title: 'Altman: "2025 will be huge for AI"',
            sentiment: 0.75,
            source: "Twitter",
          },
        ],
      },
      {
        id: "kalshi-tiktok",
        ticker: "TIKTOK",
        platform: "Kalshi",
        question: "Will TikTok be banned in the US in 2025?",
        category: "Tech",
        subcategory: "Regulation",
        market_prob: 0.42,
        model_prob: 0.52,
        prev_prob: 0.38,
        volume_24h: 230000,
        volume_total: 11500000,
        liquidity: 920000,
        spread: 0.011,
        open_interest: 3100000,
        trades_24h: 2034,
        end_date: "2025-12-31",
        created: "2024-04-01",
        resolution_source: "Federal law / executive action",
        price_history: generatePriceHistory(0.42, 90),
        orderbook: generateOrderbook(0.42),
        factors: {
          orderbook_imbalance: {
            value: 0.68,
            contribution: 0.12,
            direction: "bullish",
            desc: "Buy pressure building",
          },
          price_momentum: {
            value: 0.72,
            contribution: 0.14,
            direction: "bullish",
            desc: "Sharp recent uptick",
          },
          volume_trend: {
            value: 0.75,
            contribution: 0.1,
            direction: "bullish",
            desc: "Surging volume",
          },
          news_sentiment: {
            value: 0.78,
            contribution: 0.16,
            direction: "bullish",
            desc: "Congress moving forward",
          },
          social_sentiment: {
            value: 0.55,
            contribution: 0.04,
            direction: "neutral",
            desc: "Public opinion mixed",
          },
          smart_money: {
            value: 0.71,
            contribution: 0.11,
            direction: "bullish",
            desc: "Legal experts betting yes",
          },
          historical_pattern: {
            value: 0.45,
            contribution: -0.03,
            direction: "bearish",
            desc: "Past bans overturned",
          },
          time_decay: {
            value: 0.58,
            contribution: 0.02,
            direction: "neutral",
            desc: "Long time to expiry",
          },
          liquidity_score: {
            value: 0.85,
            contribution: 0.07,
            direction: "bullish",
            desc: "High liquidity",
          },
          model_confidence: {
            value: 0.76,
            contribution: 0.12,
            direction: "bullish",
            desc: "Models favor ban",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.54, weight: 0.35, confidence: 0.79 },
          xgboost: { prob: 0.51, weight: 0.3, confidence: 0.76 },
          logistic: { prob: 0.49, weight: 0.2, confidence: 0.72 },
          bayesian: { prob: 0.53, weight: 0.15, confidence: 0.74 },
        },
        greeks: { delta: 0.52, gamma: 0.08, theta: -0.001, vega: 0.15, rho: 0.02 },
        correlations: { META: 0.35, SNAP: 0.28, GOOGL: 0.22, PINS: 0.31 },
        related_news: [
          {
            time: "2h ago",
            title: "Supreme Court to hear TikTok case",
            sentiment: 0.7,
            source: "Reuters",
          },
          {
            time: "12h ago",
            title: "ByteDance explores sale options",
            sentiment: 0.5,
            source: "WSJ",
          },
        ],
      },
      {
        id: "poly-ukraine",
        ticker: "UKRPCE",
        platform: "Polymarket",
        question: "Will Ukraine conflict have ceasefire by Dec 2025?",
        category: "Geopolitics",
        subcategory: "Conflicts",
        market_prob: 0.32,
        model_prob: 0.41,
        prev_prob: 0.28,
        volume_24h: 210000,
        volume_total: 9800000,
        liquidity: 780000,
        spread: 0.014,
        open_interest: 2900000,
        trades_24h: 1678,
        end_date: "2025-12-31",
        created: "2024-02-01",
        resolution_source: "Official ceasefire announcement by parties",
        price_history: generatePriceHistory(0.32, 90),
        orderbook: generateOrderbook(0.32),
        factors: {
          orderbook_imbalance: {
            value: 0.62,
            contribution: 0.1,
            direction: "bullish",
            desc: "Buyers emerging",
          },
          price_momentum: {
            value: 0.68,
            contribution: 0.12,
            direction: "bullish",
            desc: "Strong recent rally",
          },
          volume_trend: {
            value: 0.72,
            contribution: 0.1,
            direction: "bullish",
            desc: "Volume spike on Trump news",
          },
          news_sentiment: {
            value: 0.65,
            contribution: 0.13,
            direction: "bullish",
            desc: "Diplomacy headlines",
          },
          social_sentiment: {
            value: 0.58,
            contribution: 0.06,
            direction: "bullish",
            desc: "Peace talks speculation",
          },
          smart_money: {
            value: 0.61,
            contribution: 0.09,
            direction: "bullish",
            desc: "Defense stocks hedging",
          },
          historical_pattern: {
            value: 0.35,
            contribution: -0.06,
            direction: "bearish",
            desc: "Conflicts rarely end quickly",
          },
          time_decay: {
            value: 0.55,
            contribution: 0.02,
            direction: "neutral",
            desc: "Long time horizon",
          },
          liquidity_score: {
            value: 0.75,
            contribution: 0.05,
            direction: "bullish",
            desc: "Good liquidity",
          },
          model_confidence: {
            value: 0.68,
            contribution: 0.08,
            direction: "bullish",
            desc: "Models cautiously bullish",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.43, weight: 0.35, confidence: 0.72 },
          xgboost: { prob: 0.4, weight: 0.3, confidence: 0.68 },
          logistic: { prob: 0.38, weight: 0.2, confidence: 0.62 },
          bayesian: { prob: 0.42, weight: 0.15, confidence: 0.65 },
        },
        greeks: { delta: 0.41, gamma: 0.11, theta: -0.001, vega: 0.22, rho: 0.03 },
        correlations: { OIL: -0.45, WHEAT: -0.52, RTX: -0.38, EUR: 0.42 },
        related_news: [
          {
            time: "3h ago",
            title: "Trump envoy meets with Putin",
            sentiment: 0.7,
            source: "AP",
          },
          {
            time: "1d ago",
            title: "Zelensky open to negotiations",
            sentiment: 0.65,
            source: "BBC",
          },
        ],
      },
      {
        id: "kalshi-recession",
        ticker: "USREC",
        platform: "Kalshi",
        question: "Will US enter recession in 2025?",
        category: "Economics",
        subcategory: "Macro",
        market_prob: 0.22,
        model_prob: 0.18,
        prev_prob: 0.25,
        volume_24h: 180000,
        volume_total: 8500000,
        liquidity: 950000,
        spread: 0.009,
        open_interest: 2600000,
        trades_24h: 1890,
        end_date: "2025-12-31",
        created: "2024-01-01",
        resolution_source: "NBER official recession dating",
        price_history: generatePriceHistory(0.22, 90),
        orderbook: generateOrderbook(0.22),
        factors: {
          orderbook_imbalance: {
            value: 0.38,
            contribution: -0.08,
            direction: "bearish",
            desc: "Sellers dominating",
          },
          price_momentum: {
            value: 0.35,
            contribution: -0.1,
            direction: "bearish",
            desc: "Downtrend continues",
          },
          volume_trend: {
            value: 0.52,
            contribution: 0.02,
            direction: "neutral",
            desc: "Stable volume",
          },
          news_sentiment: {
            value: 0.32,
            contribution: -0.12,
            direction: "bearish",
            desc: "Strong economy narrative",
          },
          social_sentiment: {
            value: 0.4,
            contribution: -0.05,
            direction: "bearish",
            desc: "Consumer confidence high",
          },
          smart_money: {
            value: 0.35,
            contribution: -0.09,
            direction: "bearish",
            desc: "Economists bullish",
          },
          historical_pattern: {
            value: 0.42,
            contribution: -0.04,
            direction: "bearish",
            desc: "Late-cycle but no triggers",
          },
          time_decay: {
            value: 0.55,
            contribution: 0.01,
            direction: "neutral",
            desc: "Time for data to develop",
          },
          liquidity_score: {
            value: 0.88,
            contribution: 0.05,
            direction: "bullish",
            desc: "Very liquid",
          },
          model_confidence: {
            value: 0.82,
            contribution: -0.11,
            direction: "bearish",
            desc: "Models confident NO",
          },
        },
        model_breakdown: {
          lightgbm: { prob: 0.17, weight: 0.35, confidence: 0.85 },
          xgboost: { prob: 0.19, weight: 0.3, confidence: 0.82 },
          logistic: { prob: 0.2, weight: 0.2, confidence: 0.78 },
          bayesian: { prob: 0.18, weight: 0.15, confidence: 0.8 },
        },
        greeks: { delta: -0.18, gamma: 0.05, theta: -0.001, vega: 0.18, rho: -0.04 },
        correlations: { FEDQ1: 0.45, SPY: -0.62, VIX: 0.55, GOLD: 0.38 },
        related_news: [
          {
            time: "4h ago",
            title: "GDP growth beats expectations",
            sentiment: -0.7,
            source: "BEA",
          },
          {
            time: "1d ago",
            title: "Unemployment holds at 3.9%",
            sentiment: -0.6,
            source: "BLS",
          },
        ],
      },
    ];

    function generatePriceHistory(currentPrice, days) {
      const history = [];
      let price = currentPrice - (Math.random() * 0.12 - 0.04);
      for (let i = days; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        price += (Math.random() - 0.48) * 0.015;
        price = Math.max(0.05, Math.min(0.95, price));
        history.push({
          date: date.toISOString().split("T")[0],
          time: date.getTime(),
          price: price,
          volume: Math.floor(Math.random() * 100000) + 50000,
          high: Math.min(0.95, price + Math.random() * 0.02),
          low: Math.max(0.05, price - Math.random() * 0.02),
        });
      }
      history[history.length - 1].price = currentPrice;
      return history;
    }

    function generateOrderbook(midPrice) {
      const bids = [], asks = [];
      let bidCumulative = 0, askCumulative = 0;
      for (let i = 1; i <= 15; i++) {
        const bidSize = Math.floor(Math.random() * 80000) + 20000;
        const askSize = Math.floor(Math.random() * 80000) + 20000;
        bidCumulative += bidSize;
        askCumulative += askSize;
        bids.push({
          price: Math.max(0.01, midPrice - i * 0.005),
          size: bidSize,
          cumulative: bidCumulative,
        });
        asks.push({
          price: Math.min(0.99, midPrice + i * 0.005),
          size: askSize,
          cumulative: askCumulative,
        });
      }
      return {
        bids,
        asks,
        imbalance:
          (bidCumulative - askCumulative) /
          (bidCumulative + askCumulative || 1),
      };
    }

    function makeRandomTrade(ticker, lastMc = 7.6) {
      const sides = ["Buy", "Sell"];
      const side = sides[Math.random() < 0.45 ? 0 : 1];
      const ageSeconds = Math.floor(Math.random() * 1200);
      const amountK = (Math.random() * 120 + 0.8).toFixed(1) + "K";
      const usd = (Math.random() * 900 + 5).toFixed(2);
      const mc = (lastMc + (Math.random() - 0.5) * 0.1).toFixed(1) + "M";
      return {
        id: ticker + "-" + Date.now() + "-" + Math.random().toString(36).slice(2, 6),
        ageLabel: ageSeconds < 60 ? `${ageSeconds}s` : `${Math.floor(ageSeconds / 60)}m`,
        side,
        mc,
        amount: amountK,
        usd,
      };
    }

    function makeInitialTrades(ticker, n = 20) {
      const trades = [];
      let mc = 7.6;
      for (let i = 0; i < n; i++) {
        const t = makeRandomTrade(ticker, mc);
        mc = parseFloat(t.mc.replace("$", "").replace("M", "")) || mc;
        trades.push(t);
      }
      return trades;
    }

    const PORTFOLIO_POSITIONS = [
      {
        market_id: "poly-btc-150k",
        side: "YES",
        shares: 500,
        avg_price: 0.31,
        current_price: 0.34,
      },
      {
        market_id: "kalshi-fed-q1",
        side: "NO",
        shares: 300,
        avg_price: 0.35,
        current_price: 0.38,
      },
      {
        market_id: "poly-spacex",
        side: "YES",
        shares: 400,
        avg_price: 0.72,
        current_price: 0.75,
      },
      {
        market_id: "poly-gpt5",
        side: "YES",
        shares: 250,
        avg_price: 0.52,
        current_price: 0.55,
      },
    ];

    const NEWS_FEED = [
      {
        id: 1,
        time: "2 min ago",
        source: "Bloomberg",
        title: "Bitcoin ETF sees $500M daily inflow, largest since launch",
        sentiment: 0.82,
        markets: ["BTC150K", "ETH5K"],
        category: "Crypto",
      },
      {
        id: 2,
        time: "15 min ago",
        source: "Reuters",
        title: "Fed officials signal patience on rate cuts amid sticky inflation",
        sentiment: -0.65,
        markets: ["FEDQ1", "USREC"],
        category: "Economics",
      },
      {
        id: 3,
        time: "32 min ago",
        source: "SpaceX",
        title: "Starship Flight 8 scheduled for January 15th",
        sentiment: 0.78,
        markets: ["SXSHIP"],
        category: "Science",
      },
      {
        id: 4,
        time: "1 hr ago",
        source: "WSJ",
        title: "TikTok ban bill advances to Senate floor vote",
        sentiment: 0.71,
        markets: ["TIKTOK"],
        category: "Tech",
      },
      {
        id: 5,
        time: "1.5 hr ago",
        source: "Twitter",
        title: '@sama: "The progress on GPT-5 is incredible. 2025 will surprise everyone."',
        sentiment: 0.85,
        markets: ["GPT5"],
        category: "Tech",
      },
      {
        id: 6,
        time: "2 hr ago",
        source: "AP",
        title: "Trump envoy holds extended meeting with Putin in Moscow",
        sentiment: 0.62,
        markets: ["UKRPCE"],
        category: "Geopolitics",
      },
      {
        id: 7,
        time: "3 hr ago",
        source: "CNBC",
        title: "US GDP Q4 comes in at 3.2%, above expectations",
        sentiment: -0.55,
        markets: ["USREC", "FEDQ1"],
        category: "Economics",
      },
      {
        id: 8,
        time: "4 hr ago",
        source: "CoinDesk",
        title: "Ethereum staking deposits hit new all-time high",
        sentiment: 0.68,
        markets: ["ETH5K"],
        category: "Crypto",
      },
    ];

    /* ===================== QUANT ENGINE ===================== */

    const QuantEngine = {
      monteCarlo: (marketProb, modelProb, config = {}) => {
        const { numSims = 5000, numTrades = 100, kellyFraction = 0.25, startingCapital = 10000 } = config;
        const results = [];
        for (let sim = 0; sim < numSims; sim++) {
          let capital = startingCapital;
          const path = [capital];
          let wins = 0, losses = 0, maxCapital = capital, maxDrawdown = 0;
          for (let t = 0; t < numTrades && capital > 0; t++) {
            const edge = modelProb - marketProb;
            const odds = 1 / marketProb - 1;
            const kelly = Math.max(0, (odds * modelProb - (1 - modelProb)) / (odds || 1)) * kellyFraction;
            const betSize = capital * Math.min(kelly, 0.05);
            if (Math.random() < modelProb) {
              capital += betSize * odds;
              wins++;
            } else {
              capital -= betSize;
              losses++;
            }
            capital = Math.max(0, capital);
            path.push(capital);
            if (capital > maxCapital) maxCapital = capital;
            const dd = (maxCapital - capital) / (maxCapital || 1);
            if (dd > maxDrawdown) maxDrawdown = dd;
          }
          results.push({
            finalCapital: capital,
            returnPct: ((capital - startingCapital) / startingCapital) * 100,
            path,
            maxDrawdown: maxDrawdown * 100,
            winRate: (wins / (wins + losses || 1)) * 100,
          });
        }
        const returns = results.map((r) => r.returnPct).sort((a, b) => a - b);
        const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
        const variance = returns.reduce((a, r) => a + Math.pow(r - mean, 2), 0) / returns.length;
        const stdDev = Math.sqrt(variance);
        const idx = (p) => returns[Math.floor(returns.length * p)] ?? returns[0];
        const tail = (p) => {
          const n = Math.floor(returns.length * p);
          if (n <= 0) return returns[0] ?? 0;
          return returns.slice(0, n).reduce((a, b) => a + b, 0) / n;
        };
        return {
          paths: results.slice(0, 40).map((r) => r.path),
          distribution: returns,
          stats: {
            expectedReturn: mean,
            medianReturn: idx(0.5),
            stdDev,
            sharpeRatio: stdDev ? mean / stdDev : 0,
            var95: idx(0.05),
            var99: idx(0.01),
            cvar95: tail(0.05),
            percentile5: idx(0.05),
            percentile25: idx(0.25),
            percentile75: idx(0.75),
            percentile95: idx(0.95),
            probProfit: (results.filter((r) => r.returnPct > 0).length / results.length) * 100,
            probRuin: (results.filter((r) => r.finalCapital <= 0).length / results.length) * 100,
            avgMaxDrawdown: results.reduce((a, r) => a + r.maxDrawdown, 0) / results.length,
            avgWinRate: results.reduce((a, r) => a + r.winRate, 0) / results.length,
          },
        };
      },

      kelly: (modelProb, marketProb) => {
        const odds = 1 / marketProb - 1;
        const full = (odds * modelProb - (1 - modelProb)) / (odds || 1);
        const safe = Math.max(0, full);
        return {
          full: safe,
          half: safe * 0.5,
          quarter: safe * 0.25,
          eighth: safe * 0.125,
          optimal: Math.max(0, Math.min(safe * 0.25, 0.05)),
        };
      },

      expectedValue: (modelProb, marketProb, stake = 1000) => {
        const payout = stake / marketProb;
        const ev = modelProb * (payout - stake) - (1 - modelProb) * stake;
        const evPct = (ev / stake) * 100;
        const edgePct = (modelProb - marketProb) * 100;
        return { ev, evPct, payout, stake, edgePct };
      },

      calculateConfluence: (factors) => {
        const weights = {
          orderbook_imbalance: 0.12,
          price_momentum: 0.1,
          volume_trend: 0.08,
          news_sentiment: 0.15,
          social_sentiment: 0.08,
          smart_money: 0.12,
          historical_pattern: 0.08,
          time_decay: 0.05,
          liquidity_score: 0.07,
          model_confidence: 0.15,
        };
        let totalScore = 0;
        let bullishCount = 0, bearishCount = 0;
        Object.entries(factors).forEach(([key, factor]) => {
          const w = weights[key] ?? 0.1;
          totalScore += factor.value * w;
          if (factor.direction === "bullish") bullishCount++;
          else if (factor.direction === "bearish") bearishCount++;
        });
        return {
          score: totalScore,
          bullishFactors: bullishCount,
          bearishFactors: bearishCount,
          agreement: Math.max(bullishCount, bearishCount) / (bullishCount + bearishCount || 1),
        };
      },

      quantumOptimize: (markets, capital = 10000) => {
        const iterations = 1000;
        let bestAllocation = {};
        let bestScore = -Infinity;
        for (let i = 0; i < iterations; i++) {
          const allocation = {};
          let remaining = 1.0;
          markets.forEach((m, idx) => {
            if (idx === markets.length - 1) {
              allocation[m.ticker] = remaining;
            } else {
              const kelly = QuantEngine.kelly(m.model_prob, m.market_prob).quarter;
              const noise = (Math.random() - 0.5) * 0.1;
              const alloc = Math.max(0, Math.min(remaining, kelly + noise));
              allocation[m.ticker] = alloc;
              remaining -= alloc;
            }
          });
          let score = 0;
          markets.forEach((m) => {
            const edge = m.model_prob - m.market_prob;
            score += (allocation[m.ticker] || 0) * edge * 100;
          });
          if (score > bestScore) {
            bestScore = score;
            bestAllocation = { ...allocation };
          }
        }
        return { allocation: bestAllocation, score: bestScore };
      },
    };

    /* ===================== UI COMPONENTS ===================== */

    const DataRow = ({ label, value, type, mono = true, small = false }) => (
      <div className={`data-row ${small ? "py-1" : ""}`}>
        <span className="data-label">{label}</span>
        <span className={`data-value ${type || ""} ${mono ? "mono" : ""}`}>{value}</span>
      </div>
    );

    const PanelHeader = ({ title, subtitle, actions }) => (
      <div className="panel-header flex items-center justify-between">
        <div className="flex items-center gap-2">
          <span>{title}</span>
          {subtitle && (
            <span className="text-gray-600 font-normal text-xs">| {subtitle}</span>
          )}
        </div>
        {actions}
      </div>
    );

    const Tag = ({ type, children }) => (
      <span className={`tag tag-${type}`}>{children}</span>
    );

    const PriceChart = ({ data, height = 120 }) => {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        if (!canvasRef.current || !data?.length) return;
        if (chartRef.current) chartRef.current.destroy();

        chartRef.current = new Chart(canvasRef.current, {
          type: "line",
          data: {
            labels: data.map((d) => d.date),
            datasets: [
              {
                data: data.map((d) => (d.price * 100).toFixed(1)),
                borderColor: "#ff6b00",
                backgroundColor: "rgba(255, 107, 0, 0.05)",
                borderWidth: 1.5,
                fill: true,
                tension: 0.2,
                pointRadius: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { mode: "index", intersect: false },
            },
            interaction: { mode: "nearest", axis: "x", intersect: false },
            scales: {
              x: { display: false },
              y: {
                display: true,
                position: "right",
                grid: { color: "#1a1a1a", drawBorder: false },
                ticks: {
                  color: "#444",
                  font: { size: 9 },
                  callback: (v) => v + "Â¢",
                },
              },
            },
          },
        });

        return () => {
          if (chartRef.current) chartRef.current.destroy();
        };
      }, [data]);

      return <canvas ref={canvasRef} style={{ height }} />;
    };

    const MonteCarloChart = ({ paths, height = 150 }) => {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        if (!canvasRef.current || !paths?.length) return;
        if (chartRef.current) chartRef.current.destroy();

        const labels = Array.from({ length: paths[0]?.length || 0 }, (_, i) => i);
        const datasets = paths.slice(0, 25).map((path) => ({
          data: path,
          borderColor:
            path[path.length - 1] > 10000
              ? "rgba(0, 210, 106, 0.25)"
              : "rgba(255, 59, 59, 0.25)",
          borderWidth: 1,
          pointRadius: 0,
          fill: false,
        }));

        const medianPath = [];
        for (let i = 0; i < (paths[0]?.length || 0); i++) {
          const vals = paths.map((p) => p[i] || 0).sort((a, b) => a - b);
          medianPath.push(vals[Math.floor(vals.length / 2)]);
        }
        datasets.push({
          data: medianPath,
          borderColor: "#ff6b00",
          borderWidth: 2,
          pointRadius: 0,
          fill: false,
        });

        chartRef.current = new Chart(canvasRef.current, {
          type: "line",
          data: { labels, datasets },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { display: false },
              y: {
                grid: { color: "#1a1a1a" },
                ticks: {
                  color: "#444",
                  font: { size: 9 },
                  callback: (v) => "$" + (v / 1000).toFixed(0) + "k",
                },
              },
            },
          },
        });

        return () => {
          if (chartRef.current) chartRef.current.destroy();
        };
      }, [paths]);

      return <canvas ref={canvasRef} style={{ height }} />;
    };

    const WatchlistPanel = ({ markets, selectedId, onSelect }) => (
      <div className="terminal-panel h-full">
        <PanelHeader title="WATCHLIST" subtitle={`${markets.length} mkts`} />
        <div className="panel-content">
          {markets.map((m) => {
            const edge = m.model_prob - m.market_prob;
            const change = m.market_prob - m.prev_prob;
            return (
              <div
                key={m.id}
                onClick={() => onSelect(m)}
                className={`px-2 py-2 border-b border-gray-900 cursor-pointer transition-colors ${
                  selectedId === m.id
                    ? "bg-orange-500/10 border-l-2 border-l-orange-500"
                    : "hover:bg-gray-900/50"
                }`}
              >
                <div className="flex items-center justify-between mb-1">
                  <span className="text-xs font-bold text-orange-500 mono">
                    {m.ticker}
                  </span>
                  <span className={`text-xs mono ${edge > 0 ? "positive" : "negative"}`}>
                    {edge > 0 ? "+" : ""}
                    {(edge * 100).toFixed(1)}%
                  </span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-xs text-gray-500">
                    {(m.market_prob * 100).toFixed(1)}Â¢
                  </span>
                  <span
                    className={`text-xs ${
                      change > 0
                        ? "positive"
                        : change < 0
                        ? "negative"
                        : "text-gray-500"
                    }`}
                  >
                    {change > 0 ? "â²" : change < 0 ? "â¼" : "â¢"}{" "}
                    {Math.abs(change * 100).toFixed(1)}
                  </span>
                </div>
                <div className="flex items-center gap-1 mt-1">
                  <Tag type="platform">{m.platform.slice(0, 4)}</Tag>
                  <Tag
                    type={
                      edge > 0.03
                        ? "buy"
                        : edge < -0.03
                        ? "sell"
                        : "hold"
                    }
                  >
                    {edge > 0.03
                      ? "BUY"
                      : edge < -0.03
                      ? "SELL"
                      : "HOLD"}
                  </Tag>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );

    const MarketOverviewPanel = ({ market }) => {
      if (!market)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      const edge = market.model_prob - market.market_prob;
      const kelly = QuantEngine.kelly(market.model_prob, market.market_prob);
      const ev = QuantEngine.expectedValue(market.model_prob, market.market_prob);

      return (
        <div className="terminal-panel h-full">
          <PanelHeader title={market.ticker} subtitle={market.platform} />
          <div className="panel-content p-2">
            <div className="text-xs text-gray-400 mb-2 leading-tight">
              {market.question}
            </div>

            <div className="flex gap-1 mb-3">
              <Tag type="category">{market.category}</Tag>
              <Tag
                type={
                  edge > 0.03 ? "buy" : edge < -0.03 ? "sell" : "hold"
                }
              >
                {edge > 0.03 ? "BUY" : edge < -0.03 ? "SELL" : "HOLD"}
              </Tag>
            </div>

            <div className="grid grid-cols-2 gap-x-3">
              <DataRow
                label="Market"
                value={`${(market.market_prob * 100).toFixed(2)}Â¢`}
              />
              <DataRow
                label="Model"
                value={`${(market.model_prob * 100).toFixed(2)}Â¢`}
                type="info"
              />
              <DataRow
                label="Edge"
                value={`${edge > 0 ? "+" : ""}${(edge * 100).toFixed(2)}%`}
                type={edge > 0 ? "positive" : "negative"}
              />
              <DataRow
                label="KellyÂ¼"
                value={`${(kelly.quarter * 100).toFixed(2)}%`}
                type="highlight"
              />
              <DataRow
                label="EV/$1k"
                value={`$${ev.ev.toFixed(0)}`}
                type={ev.ev > 0 ? "positive" : "negative"}
              />
              <DataRow
                label="Spread"
                value={`${(market.spread * 100).toFixed(2)}%`}
              />
            </div>

            <div className="border-t border-gray-800 mt-2 pt-2">
              <div className="text-xs text-gray-600 mb-1">MARKET DATA</div>
              <DataRow
                label="Vol 24h"
                value={`$${(market.volume_24h / 1000).toFixed(0)}k`}
                small
              />
              <DataRow
                label="Liquidity"
                value={`$${(market.liquidity / 1000).toFixed(0)}k`}
                small
              />
              <DataRow
                label="OI"
                value={`$${(market.open_interest / 1000000).toFixed(2)}M`}
                small
              />
              <DataRow
                label="Trades"
                value={market.trades_24h.toLocaleString()}
                small
              />
              <DataRow label="Expiry" value={market.end_date} small />
            </div>
          </div>
        </div>
      );
    };

    const ConfluencePanel = ({ market }) => {
      if (!market)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      const confluence = QuantEngine.calculateConfluence(market.factors);
      const sortedFactors = Object.entries(market.factors).sort(
        (a, b) => Math.abs(b[1].contribution) - Math.abs(a[1].contribution)
      );

      return (
        <div className="terminal-panel h-full">
          <PanelHeader
            title="CONFLUENCE"
            subtitle={`Score: ${(confluence.score * 100).toFixed(0)}%`}
          />
          <div className="panel-content p-2">
            <div className="mb-3">
              <div className="flex items-center justify-between text-xs mb-1">
                <span className="text-gray-500">Overall Confluence</span>
                <span
                  className={
                    confluence.score > 0.6
                      ? "positive"
                      : confluence.score > 0.4
                      ? "neutral"
                      : "negative"
                  }
                >
                  {(confluence.score * 100).toFixed(0)}%
                </span>
              </div>
              <div className="confluence-bar">
                <div
                  className="confluence-fill"
                  style={{
                    width: `${confluence.score * 100}%`,
                    background:
                      confluence.score > 0.6
                        ? "#00d26a"
                        : confluence.score > 0.4
                        ? "#ffd000"
                        : "#ff3b3b",
                  }}
                />
              </div>
              <div className="flex justify-between text-xs mt-1">
                <span className="positive">
                  {confluence.bullishFactors} bullish
                </span>
                <span className="negative">
                  {confluence.bearishFactors} bearish
                </span>
              </div>
            </div>

            <div className="text-xs text-gray-600 mb-1">
              FACTOR CONTRIBUTIONS
            </div>
            {sortedFactors.map(([key, factor]) => (
              <div key={key} className="mb-2">
                <div className="flex items-center justify-between text-xs">
                  <span className="text-gray-400 capitalize">
                    {key.replace(/_/g, " ")}
                  </span>
                  <span
                    className={
                      factor.contribution > 0
                        ? "positive"
                        : factor.contribution < 0
                        ? "negative"
                        : "text-gray-500"
                    }
                  >
                    {factor.contribution > 0 ? "+" : ""}
                    {(factor.contribution * 100).toFixed(1)}%
                  </span>
                </div>
                <div className="shap-bar relative">
                  <div className="absolute inset-y-0 left-1/2 w-px bg-gray-700" />
                  {factor.contribution < 0 && (
                    <div
                      className="shap-negative h-full absolute right-1/2"
                      style={{
                        width: `${Math.abs(factor.contribution) * 500}%`,
                      }}
                    />
                  )}
                  {factor.contribution > 0 && (
                    <div
                      className="shap-positive h-full absolute left-1/2"
                      style={{
                        width: `${factor.contribution * 500}%`,
                      }}
                    />
                  )}
                </div>
                <div className="text-xs text-gray-600 mt-0.5">
                  {factor.desc}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const MonteCarloPanel = ({ market }) => {
      const [simulation, setSimulation] = useState(null);

      useEffect(() => {
        if (market) {
          const result = QuantEngine.monteCarlo(
            market.market_prob,
            market.model_prob
          );
          setSimulation(result);
        }
      }, [market]);

      if (!market || !simulation)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      const s = simulation.stats;

      return (
        <div className="terminal-panel h-full">
          <PanelHeader
            title="MONTE CARLO"
            subtitle="5k sims Ã 100 trades"
          />
          <div className="panel-content">
            <div className="p-2">
              <MonteCarloChart paths={simulation.paths} height={120} />
            </div>
            <div className="px-2 pb-2 border-t border-gray-800">
              <div className="grid grid-cols-2 gap-x-3 mt-2">
                <DataRow
                  label="E[Return]"
                  value={`${s.expectedReturn >= 0 ? "+" : ""}${s.expectedReturn.toFixed(1)}%`}
                  type={s.expectedReturn > 0 ? "positive" : "negative"}
                />
                <DataRow
                  label="Median"
                  value={`${s.medianReturn >= 0 ? "+" : ""}${s.medianReturn.toFixed(1)}%`}
                  type={s.medianReturn > 0 ? "positive" : "negative"}
                />
                <DataRow
                  label="Sharpe"
                  value={s.sharpeRatio.toFixed(2)}
                />
                <DataRow
                  label="Std Dev"
                  value={`${s.stdDev.toFixed(1)}%`}
                />
                <DataRow
                  label="VaR 95%"
                  value={`${s.var95.toFixed(1)}%`}
                  type="negative"
                />
                <DataRow
                  label="CVaR 95%"
                  value={`${s.cvar95.toFixed(1)}%`}
                  type="negative"
                />
                <DataRow
                  label="P(Profit)"
                  value={`${s.probProfit.toFixed(1)}%`}
                  type={s.probProfit > 50 ? "positive" : "negative"}
                />
                <DataRow
                  label="Max DD"
                  value={`-${s.avgMaxDrawdown.toFixed(1)}%`}
                  type="negative"
                />
              </div>
              <div className="mt-2 pt-2 border-t border-gray-800">
                <div className="text-xs text-gray-600 mb-1">
                  PERCENTILES
                </div>
                <div className="flex justify-between text-xs mono">
                  <span className="negative">
                    5%: {s.percentile5.toFixed(0)}
                  </span>
                  <span className="neutral">
                    25%: {s.percentile25.toFixed(0)}
                  </span>
                  <span className="text-gray-400">
                    50%: {s.medianReturn.toFixed(0)}
                  </span>
                  <span className="info">
                    75%: {s.percentile75.toFixed(0)}
                  </span>
                  <span className="positive">
                    95%: +{s.percentile95.toFixed(0)}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const ModelBreakdownPanel = ({ market }) => {
      if (!market)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      const models = market.model_breakdown;

      return (
        <div className="terminal-panel h-full">
          <PanelHeader title="MODEL ENSEMBLE" subtitle="4 models" />
          <div className="panel-content p-2">
            {Object.entries(models).map(([name, model]) => (
              <div key={name} className="mb-3">
                <div className="flex items-center justify-between text-xs mb-1">
                  <span className="text-gray-400 capitalize">
                    {name}
                  </span>
                  <span className="mono text-gray-300">
                    {(model.prob * 100).toFixed(1)}%
                  </span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="flex-1 confluence-bar">
                    <div
                      className="confluence-fill bg-gradient-to-r from-orange-500 to-yellow-500"
                      style={{ width: `${model.prob * 100}%` }}
                    />
                  </div>
                  <span className="text-xs text-gray-500 w-10">
                    {(model.weight * 100).toFixed(0)}%w
                  </span>
                </div>
                <div className="flex items-center justify-between text-xs mt-0.5">
                  <span className="text-gray-600">Confidence</span>
                  <span
                    className={
                      model.confidence > 0.8
                        ? "positive"
                        : model.confidence > 0.6
                        ? "neutral"
                        : "negative"
                    }
                  >
                    {(model.confidence * 100).toFixed(0)}%
                  </span>
                </div>
              </div>
            ))}

            <div className="border-t border-gray-800 pt-2 mt-2">
              <div className="flex items-center justify-between text-xs">
                <span className="text-gray-300 font-medium">
                  Ensemble
                </span>
                <span className="mono text-orange-500 font-bold">
                  {(market.model_prob * 100).toFixed(1)}%
                </span>
              </div>
              <div className="confluence-bar mt-1">
                <div
                  className="confluence-fill bg-orange-500"
                  style={{ width: `${market.model_prob * 100}%` }}
                />
              </div>
            </div>
          </div>
        </div>
      );
    };

    const PriceChartPanel = ({ market }) => {
      if (!market)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      return (
        <div className="terminal-panel h-full">
          <PanelHeader title="PRICE" subtitle={`${market.ticker} 90D`} />
          <div className="panel-content p-1">
            <PriceChart data={market.price_history} height={140} />
          </div>
        </div>
      );
    };

    const OrderBookPanel = ({ market }) => {
      if (!market)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      const { bids, asks, imbalance } = market.orderbook;
      const maxCumulative = Math.max(
        bids[bids.length - 1]?.cumulative || 0,
        asks[asks.length - 1]?.cumulative || 0
      );

      return (
        <div className="terminal-panel h-full">
          <PanelHeader
            title="ORDER BOOK"
            subtitle={`Imbal: ${
              imbalance > 0 ? "+" : ""
            }${(imbalance * 100).toFixed(1)}%`}
          />
          <div className="panel-content">
            <div className="grid grid-cols-3 text-xs text-gray-600 px-2 py-1 border-b border-gray-800">
              <span>BID</span>
              <span className="text-center">PRICE</span>
              <span className="text-right">ASK</span>
            </div>
            {bids.slice(0, 10).map((bid, i) => {
              const ask = asks[i];
              return (
                <div
                  key={i}
                  className="grid grid-cols-3 text-xs mono px-2 py-0.5 relative"
                >
                  <div
                    className="absolute inset-y-0 left-0 bg-green-500/10"
                    style={{
                      width: `${
                        (bid.cumulative / (maxCumulative || 1)) * 50
                      }%`,
                    }}
                  />
                  <div
                    className="absolute inset-y-0 right-0 bg-red-500/10"
                    style={{
                      width: `${
                        (ask.cumulative / (maxCumulative || 1)) * 50
                      }%`,
                    }}
                  />
                  <span className="relative text-gray-500">
                    {(bid.size / 1000).toFixed(0)}k
                  </span>
                  <span className="relative text-center">
                    <span className="positive">
                      {(bid.price * 100).toFixed(1)}
                    </span>
                    <span className="text-gray-600"> / </span>
                    <span className="negative">
                      {(ask.price * 100).toFixed(1)}
                    </span>
                  </span>
                  <span className="relative text-right text-gray-500">
                    {(ask.size / 1000).toFixed(0)}k
                  </span>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const NewsFeedPanel = ({ news, onNewsClick }) => (
      <div className="terminal-panel h-full">
        <PanelHeader title="NEWS & SOCIAL" subtitle="Live feed â¢ Click to jump" />
        <div className="panel-content">
          {news.map((item) => (
            <div
              key={item.id}
              className={`news-item px-2 py-2 border-b border-gray-900 cursor-pointer hover:bg-gray-900 ${
                item.sentiment > 0.3
                  ? "news-positive"
                  : item.sentiment < -0.3
                  ? "news-negative"
                  : "news-neutral"
              }`}
              onClick={() => onNewsClick && onNewsClick(item)}
            >
              <div className="flex items-center justify-between mb-1">
                <span className="text-xs text-orange-500">
                  {item.source}
                </span>
                <span className="text-xs text-gray-600">
                  {item.time}
                </span>
              </div>
              <div className="text-xs text-gray-300 leading-tight mb-1">
                {item.title}
              </div>
              <div className="flex items-center gap-2">
                <span
                  className={`text-xs ${
                    item.sentiment > 0 ? "positive" : "negative"
                  }`}
                >
                  {item.sentiment > 0 ? "â" : "â"}{" "}
                  {Math.abs(item.sentiment * 100).toFixed(0)}%
                </span>
                <div className="flex gap-1">
                  {item.markets.map((t) => (
                    <span
                      key={t}
                      className="text-xs text-gray-500 bg-gray-800 px-1 rounded hover:bg-orange-900"
                    >
                      {t}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );

    const GreeksPanel = ({ market }) => {
      if (!market)
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );

      return (
        <div className="terminal-panel h-full">
          <PanelHeader title="GREEKS" subtitle="Risk metrics" />
          <div className="panel-content p-2">
            <div className="text-xs text-gray-600 mb-1">
              SENSITIVITIES
            </div>
            <DataRow
              label="Delta (Î)"
              value={market.greeks.delta.toFixed(3)}
              type={market.greeks.delta > 0 ? "positive" : "negative"}
            />
            <DataRow
              label="Gamma (Î)"
              value={market.greeks.gamma.toFixed(3)}
            />
            <DataRow
              label="Theta (Î)"
              value={market.greeks.theta.toFixed(4)}
              type="negative"
            />
            <DataRow
              label="Vega (Î½)"
              value={market.greeks.vega.toFixed(3)}
            />
            <DataRow
              label="Rho (Ï)"
              value={market.greeks.rho.toFixed(3)}
            />

            <div className="text-xs text-gray-600 mt-3 mb-1">
              CORRELATIONS
            </div>
            {Object.entries(market.correlations)
              .slice(0, 4)
              .map(([ticker, corr]) => (
                <DataRow
                  key={ticker}
                  label={ticker}
                  value={corr.toFixed(2)}
                  type={
                    corr > 0.3
                      ? "positive"
                      : corr < -0.3
                      ? "negative"
                      : ""
                  }
                />
              ))}
          </div>
        </div>
      );
    };

    const PortfolioPanel = ({ positions, markets }) => {
      const enrichedPositions = positions.map((p) => {
        const market = markets.find((m) => m.id === p.market_id);
        const pnl =
          (p.current_price - p.avg_price) *
          p.shares *
          (p.side === "NO" ? -1 : 1);
        const pnlPct =
          ((p.current_price - p.avg_price) / (p.avg_price || 1) * 100) *
          (p.side === "NO" ? -1 : 1);
        return { ...p, market, pnl, pnlPct };
      });

      const totalPnL = enrichedPositions.reduce((sum, p) => sum + p.pnl, 0);
      const totalValue = enrichedPositions.reduce(
        (sum, p) => sum + p.shares * p.current_price,
        0
      );

      return (
        <div className="terminal-panel h-full">
          <PanelHeader
            title="PORTFOLIO"
            subtitle={`${positions.length} positions`}
          />
          <div className="panel-content">
            <div className="px-2 py-2 border-b border-gray-800 bg-gray-900/30">
              <div className="flex justify-between text-xs">
                <span className="text-gray-500">Total Value</span>
                <span className="mono">${totalValue.toFixed(0)}</span>
              </div>
              <div className="flex justify-between text-xs mt-1">
                <span className="text-gray-500">Unrealized P&L</span>
                <span
                  className={`mono ${
                    totalPnL >= 0 ? "positive" : "negative"
                  }`}
                >
                  {totalPnL >= 0 ? "+" : ""}${totalPnL.toFixed(2)}
                </span>
              </div>
            </div>
            {enrichedPositions.map((p, i) => (
              <div key={i} className="px-2 py-2 border-b border-gray-900">
                <div className="flex justify-between items-center mb-1">
                  <span className="text-xs font-bold text-orange-500">
                    {p.market?.ticker || "N/A"}
                  </span>
                  <Tag type={p.side === "YES" ? "buy" : "sell"}>
                    {p.side}
                  </Tag>
                </div>
                <div className="grid grid-cols-3 gap-2 text-xs">
                  <div>
                    <span className="text-gray-600">Shares</span>
                    <div className="mono">{p.shares}</div>
                  </div>
                  <div>
                    <span className="text-gray-600">Avg</span>
                    <div className="mono">
                      {(p.avg_price * 100).toFixed(1)}Â¢
                    </div>
                  </div>
                  <div>
                    <span className="text-gray-600">P&L</span>
                    <div
                      className={`mono ${
                        p.pnl >= 0 ? "positive" : "negative"
                      }`}
                    >
                      {p.pnl >= 0 ? "+" : ""}${p.pnl.toFixed(2)}
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const QuantumLabPanel = ({ markets }) => {
      const [result, setResult] = useState(null);
      const [running, setRunning] = useState(false);

      const runOptimization = () => {
        setRunning(true);
        setTimeout(() => {
          const res = QuantEngine.quantumOptimize(
            markets.filter((m) => m.model_prob - m.market_prob > 0.02)
          );
          setResult(res);
          setRunning(false);
        }, 1000);
      };

      return (
        <div className="terminal-panel h-full quantum-glow">
          <PanelHeader title="â QUANTUM LAB" subtitle="Experimental" />
          <div className="panel-content p-2">
            <div className="text-xs text-purple-400 mb-2">
              Quantum-Inspired Portfolio Optimization
            </div>
            <div className="text-xs text-gray-500 mb-3">
              Uses simulated quantum annealing to find optimal position allocations
              across markets with positive edge.
            </div>

            <button
              onClick={runOptimization}
              disabled={running}
              className={`btn w-full mb-3 ${running ? "" : "primary"}`}
            >
              {running
                ? "â Running Quantum Optimization..."
                : "â Run Optimization"}
            </button>

            {result && (
              <div>
                <div className="text-xs text-gray-600 mb-1">
                  OPTIMAL ALLOCATION
                </div>
                {Object.entries(result.allocation).map(([ticker, alloc]) => (
                  <div
                    key={ticker}
                    className="flex justify-between text-xs py-1 border-b border-gray-900"
                  >
                    <span className="text-purple-400">{ticker}</span>
                    <span className="mono">
                      {(alloc * 100).toFixed(1)}%
                    </span>
                  </div>
                ))}
                <div className="flex justify-between text-xs mt-2 pt-2 border-t border-gray-800">
                  <span className="text-gray-500">
                    Expected Edge Score
                  </span>
                  <span className="mono positive">
                    +{result.score.toFixed(2)}%
                  </span>
                </div>
              </div>
            )}

            <div className="mt-3 pt-3 border-t border-gray-800 text-xs text-gray-600">
              â ï¸ Experimental feature. Results are for research purposes only.
            </div>
          </div>
        </div>
      );
    };

    const MarketTradesPanel = ({ market }) => {
      const [trades, setTrades] = useState([]);

      useEffect(() => {
        if (!market) return;
        const base = makeInitialTrades(market.ticker, 30);
        setTrades(base);

        const id = setInterval(() => {
          setTrades((prev) => {
            const next = [makeRandomTrade(market.ticker), ...prev];
            return next.slice(0, 60);
          });
        }, 4000);

        return () => clearInterval(id);
      }, [market?.id]);

      if (!market) {
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );
      }

      return (
        <div className="terminal-panel h-full">
          <PanelHeader title="TRADES" subtitle={market.ticker} />
          <div className="panel-content text-xs">
            <div className="grid grid-cols-5 px-2 py-1 border-b border-gray-800 text-[10px] text-gray-500">
              <span>Age</span>
              <span>Type</span>
              <span className="text-right">MC</span>
              <span className="text-right">Amount</span>
              <span className="text-right">Total USD</span>
            </div>
            {trades.map((t) => (
              <div
                key={t.id}
                className="grid grid-cols-5 px-2 py-1 border-b border-gray-900 hover:bg-gray-900/60"
              >
                <span className="text-gray-500">{t.ageLabel}</span>
                <span
                  className={t.side === "Buy" ? "text-green-400" : "text-red-400"}
                >
                  {t.side}
                </span>
                <span className="text-right text-gray-400">{t.mc}</span>
                <span className="text-right text-gray-400">{t.amount}</span>
                <span
                  className={`text-right mono ${
                    t.side === "Buy" ? "text-green-400" : "text-red-400"
                  }`}
                >
                  ${t.usd}
                </span>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const BuySellPanel = ({ market }) => {
      const [side, setSide] = useState("YES");
      const [size, setSize] = useState(1000);

      if (!market) {
        return (
          <div className="terminal-panel h-full flex items-center justify-center text-gray-600 text-xs">
            Select a market
          </div>
        );
      }

      const ev = QuantEngine.expectedValue(market.model_prob, market.market_prob, size);
      const kelly = QuantEngine.kelly(market.model_prob, market.market_prob);

      return (
        <div className="terminal-panel h-full">
          <PanelHeader title="BUY / SELL" subtitle="Analysis Only" />
          <div className="panel-content p-2 text-xs">
            <div className="flex gap-2 mb-3">
              <button
                className={`flex-1 btn ${side === "YES" ? "primary" : ""}`}
                onClick={() => setSide("YES")}
              >
                Buy YES
              </button>
              <button
                className={`flex-1 btn ${side === "NO" ? "danger" : ""}`}
                onClick={() => setSide("NO")}
              >
                Buy NO
              </button>
            </div>

            <div className="mb-3">
              <div className="flex justify-between mb-1">
                <span className="text-gray-500">Size (USD)</span>
                <span className="mono">${size}</span>
              </div>
              <input
                type="range"
                min="100"
                max="5000"
                step="100"
                value={size}
                onChange={(e) => setSize(parseInt(e.target.value, 10))}
                className="w-full"
              />
              <div className="flex justify-between mt-1 text-[10px] text-gray-500">
                <span>$100</span>
                <span>$2500</span>
                <span>$5k</span>
              </div>
            </div>

            <div className="border-t border-gray-800 pt-2 space-y-1">
              <DataRow
                label="Market Prob"
                value={`${(market.market_prob * 100).toFixed(1)}%`}
              />
              <DataRow
                label="Model Prob"
                value={`${(market.model_prob * 100).toFixed(1)}%`}
                type="info"
              />
              <DataRow
                label="Edge"
                value={`${(
                  (market.model_prob - market.market_prob) * 100
                ).toFixed(1)}%`}
                type={
                  market.model_prob > market.market_prob
                    ? "positive"
                    : "negative"
                }
              />
              <DataRow
                label="EV on Size"
                value={`${ev.ev >= 0 ? "+" : ""}$${ev.ev.toFixed(2)}`}
                type={ev.ev > 0 ? "positive" : "negative"}
              />
              <DataRow
                label="Kelly (full)"
                value={`${(kelly.full * 100).toFixed(1)}%`}
              />
              <DataRow
                label="Kelly (Â¼)"
                value={`${(kelly.quarter * 100).toFixed(1)}%`}
                type="highlight"
              />
            </div>

            <div className="mt-3 pt-2 border-t border-gray-800 text-[10px] text-gray-500 leading-snug">
              â  This panel is for sizing and edge analysis only. Leet Quantum
              Terminal does not execute orders on Polymarket or Kalshi.
            </div>
          </div>
        </div>
      );
    };

    const MarketDetailDock = ({ market, show, onToggle }) => {
      const [mode, setMode] = useState("price");

      if (!market) return null;
      const heightClass = show ? "h-full" : "h-6";

      return (
        <div className={heightClass + " transition-all duration-200"}>
          <div className="terminal-panel h-full">
            <div
              className="panel-header flex items-center justify-between cursor-pointer"
              onClick={onToggle}
            >
              <div className="flex items-center gap-2">
                <span className="text-xs text-gray-500">DETAIL</span>
                <span className="mono text-orange-500">
                  {market.ticker}
                </span>
                <span className="text-gray-500 text-[10px] truncate max-w-[260px]">
                  {market.question}
                </span>
              </div>
              <div className="flex items-center gap-3">
                <div className="flex text-[10px] bg-black/40 rounded border border-gray-800 overflow-hidden">
                  {["price", "events", "mc", "lhs"].map((m) => (
                    <button
                      key={m}
                      onClick={(e) => {
                        e.stopPropagation();
                        setMode(m);
                      }}
                      className={`px-2 py-0.5 uppercase ${
                        mode === m
                          ? "bg-orange-500 text-black"
                          : "text-gray-500 hover:text-gray-200"
                      }`}
                    >
                      {m === "price" && "Price"}
                      {m === "events" && "Key Pts"}
                      {m === "mc" && "Monte Carlo"}
                      {m === "lhs" && "LHS"}
                    </button>
                  ))}
                </div>
                <span className="text-[10px] text-gray-500">
                  {show ? "â¼ collapse" : "â² expand"}
                </span>
              </div>
            </div>
            {show && (
              <div className="panel-content p-1">
                <div className="grid grid-cols-12 gap-1 h-full">
                  <div className="col-span-7 h-full bg-[#050505] border border-gray-900 rounded-sm flex flex-col">
                    <div className="flex items-center justify-between px-2 pt-1 text-[10px] text-gray-500">
                      <span>
                        {mode === "price" && "Probability over time"}
                        {mode === "events" && "Annotated key points (stub)"}
                        {mode === "mc" &&
                          "Monte Carlo distribution (stub â wire later)"}
                        {mode === "lhs" && "LHS scenarios (stub)"}
                      </span>
                      <span className="text-gray-600">
                        chart modes WIP
                      </span>
                    </div>
                    <div className="flex-1 p-1">
                      <PriceChart
                        data={market.price_history}
                        height={150}
                      />
                    </div>
                  </div>

                  <div className="col-span-3 h-full">
                    <MarketTradesPanel market={market} />
                  </div>

                  <div className="col-span-2 h-full">
                    <BuySellPanel market={market} />
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    /* ===================== MAIN TERMINAL ===================== */

    const Terminal = () => {
      // Live market data state
      const [markets, setMarkets] = useState(MARKETS_DATABASE); // Fallback to demo data
      const [loadingMarkets, setLoadingMarkets] = useState(true);
      const [platformFilter, setPlatformFilter] = useState("all"); // "all" | "polymarket" | "kalshi"

      const [selectedMarket, setSelectedMarket] = useState(null);
      const [command, setCommand] = useState("");
      const [workspace, setWorkspace] = useState("analysis");
      const [time, setTime] = useState(new Date());

      // global resizable layout
      const [leftWidth, setLeftWidth] = useState(260);       // px watchlist
      const [detailHeight, setDetailHeight] = useState(220); // px bottom dock
      // analytics internal split (Confluence vs right column)
      const [analyticsWidth, setAnalyticsWidth] = useState(420);

      const dragStateRef = useRef({ type: null, startX: 0, startY: 0, startVal: 0 });

      // Fetch live markets from API
      useEffect(() => {
        const fetchMarkets = async () => {
          try {
            setLoadingMarkets(true);
            const res = await fetch('/api/markets/latest?platform=polymarket,kalshi&status=open&limit=200');
            const data = await res.json();

            if (data.markets && data.markets.length > 0) {
              // Filter to only future/active markets
              const now = new Date();
              const cleaned = data.markets
                .filter(m => m.status === 'open' && new Date(m.end_date) > now)
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

              setMarkets(cleaned);
              if (!selectedMarket && cleaned.length > 0) {
                setSelectedMarket(cleaned[0]);
              }
            } else {
              // Fallback to demo data if API fails
              console.warn('Using demo market data');
              setMarkets(MARKETS_DATABASE);
              if (!selectedMarket) {
                setSelectedMarket(MARKETS_DATABASE[0]);
              }
            }
          } catch (e) {
            console.error('Failed to load markets', e);
            // Fallback to demo data
            setMarkets(MARKETS_DATABASE);
            if (!selectedMarket) {
              setSelectedMarket(MARKETS_DATABASE[0]);
            }
          } finally {
            setLoadingMarkets(false);
          }
        };

        fetchMarkets();
        // Optional: refresh every 30 seconds for near-real-time
        const id = setInterval(fetchMarkets, 30000);
        return () => clearInterval(id);
      }, []);

      useEffect(() => {
        const timer = setInterval(() => setTime(new Date()), 1000);
        return () => clearInterval(timer);
      }, []);

      const handleCommand = (e) => {
        if (e.key === "Enter" && command) {
          const cmd = command.toUpperCase().trim();
          const market = markets.find((m) => m.ticker === cmd);
          if (market) {
            setSelectedMarket(market);
            setCommand("");
            return;
          }
          if (["ANALYSIS", "ANA"].includes(cmd)) setWorkspace("analysis");
          else if (["PORTFOLIO", "PORT"].includes(cmd)) setWorkspace("portfolio");
          else if (["LAB", "QUANTUM"].includes(cmd)) setWorkspace("lab");
          else if (["SCAN"].includes(cmd)) setWorkspace("scan");
          setCommand("");
        }
      };

      // Filter markets by platform
      const filteredMarkets = React.useMemo(() => {
        if (platformFilter === "all") return markets;
        return markets.filter(m => m.platform.toLowerCase() === platformFilter);
      }, [markets, platformFilter]);

      // Handle news click - auto-switch to market's platform and select it
      const handleNewsSelect = (newsItem) => {
        const tickers = newsItem.markets || [];
        const targetMarket = markets.find(m => tickers.includes(m.ticker));

        if (targetMarket) {
          // Switch to the market's platform
          const platform = targetMarket.platform.toLowerCase();
          setPlatformFilter(platform);

          // Select the market
          setSelectedMarket(targetMarket);

          // Optionally switch to analysis workspace
          setWorkspace("analysis");
        }
      };

      const startDrag = (type, event) => {
        if (type === "left") {
          dragStateRef.current = {
            type,
            startX: event.clientX,
            startVal: leftWidth,
          };
        } else if (type === "detail") {
          dragStateRef.current = {
            type,
            startY: event.clientY,
            startVal: detailHeight,
          };
        } else if (type === "analytics") {
          dragStateRef.current = {
            type,
            startX: event.clientX,
            startVal: analyticsWidth,
          };
        }
        window.addEventListener("mousemove", onDrag);
        window.addEventListener("mouseup", stopDrag);
      };

      const onDrag = (event) => {
        const state = dragStateRef.current;
        if (!state.type) return;

        if (state.type === "left") {
          const dx = event.clientX - state.startX;
          let next = state.startVal + dx;
          const maxWidth = window.innerWidth - 260; // leave min 260px for right side
          next = Math.max(140, Math.min(maxWidth, next));
          setLeftWidth(next);
        } else if (state.type === "detail") {
          const dy = event.clientY - state.startY;
          let next = state.startVal - dy; // drag up increases height
          const maxHeight = window.innerHeight - 160; // headers & status bar
          next = Math.max(80, Math.min(maxHeight, next));
          setDetailHeight(next);
        } else if (state.type === "analytics") {
          const dx = event.clientX - state.startX;
          let next = state.startVal + dx;
          const container = document.getElementById("analytics-container");
          const containerWidth = container ? container.clientWidth : window.innerWidth;
          const maxWidth = containerWidth - 260; // ensure right column visible
          next = Math.max(260, Math.min(maxWidth, next));
          setAnalyticsWidth(next);
        }
      };

      const stopDrag = () => {
        dragStateRef.current = { type: null, startX: 0, startY: 0, startVal: 0 };
        window.removeEventListener("mousemove", onDrag);
        window.removeEventListener("mouseup", stopDrag);
      };

      useEffect(() => {
        return () => {
          window.removeEventListener("mousemove", onDrag);
          window.removeEventListener("mouseup", stopDrag);
        };
      }, []);

      const tickerItems = filteredMarkets.slice(0, 12).map((m) => {
        const edge = m.model_prob - m.market_prob;
        const change = m.market_prob - (m.prev_prob || m.market_prob);
        return (
          <span
            key={m.id}
            className="inline-flex items-center gap-1 mx-3 text-xs"
          >
            <span className="text-orange-500 font-bold">
              {m.ticker}
            </span>
            <span className="text-gray-400">
              {(m.market_prob * 100).toFixed(1)}Â¢
            </span>
            <span
              className={
                change > 0
                  ? "positive"
                  : change < 0
                  ? "negative"
                  : "text-gray-500"
              }
            >
              {change > 0 ? "â²" : change < 0 ? "â¼" : "â¢"}
              {Math.abs(change * 100).toFixed(1)}
            </span>
            <span className={edge > 0 ? "positive" : "negative"}>
              [{edge > 0 ? "+" : ""}
              {(edge * 100).toFixed(1)}%]
            </span>
          </span>
        );
      });

      const renderRightGrid = () => {
        if (workspace === "analysis") {
          return (
            <div className="h-full flex flex-col gap-1.5">
              {/* Top row: Market / Price / Orderbook */}
              <div className="flex gap-1.5" style={{ flex: "0 0 48%" }}>
                <div className="flex-1">
                  <MarketOverviewPanel market={selectedMarket} />
                </div>
                <div className="flex-1">
                  <PriceChartPanel market={selectedMarket} />
                </div>
                <div className="w-64">
                  <OrderBookPanel market={selectedMarket} />
                </div>
              </div>

              {/* Bottom analytics with internal split handle */}
              <div
                id="analytics-container"
                className="flex-1 min-h-0 flex gap-1.5"
              >
                <div
                  id="analytics-left"
                  className="h-full"
                  style={{ flex: `0 0 ${analyticsWidth}px` }}
                >
                  <ConfluencePanel market={selectedMarket} />
                </div>

                <div
                  className="split-handle-x"
                  onMouseDown={(e) => startDrag("analytics", e)}
                />

                <div className="flex-1 min-w-0 grid grid-rows-2 gap-1.5">
                  <div className="row-span-1">
                    <ModelBreakdownPanel market={selectedMarket} />
                  </div>
                  <div className="row-span-1 grid grid-cols-2 gap-1.5">
                    <div className="col-span-1">
                      <GreeksPanel market={selectedMarket} />
                    </div>
                    <div className="col-span-1">
                      <MonteCarloPanel market={selectedMarket} />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        }

        if (workspace === "portfolio") {
          return (
            <div className="h-full grid grid-cols-10 grid-rows-6 gap-1.5">
              <div className="col-span-3 row-span-6">
                <PortfolioPanel
                  positions={PORTFOLIO_POSITIONS}
                  markets={MARKETS_DATABASE}
                />
              </div>
              <div className="col-span-4 row-span-3">
                <PriceChartPanel market={selectedMarket} />
              </div>
              <div className="col-span-3 row-span-3">
                <GreeksPanel market={selectedMarket} />
              </div>
              <div className="col-span-5 row-span-3">
                <MonteCarloPanel market={selectedMarket} />
              </div>
              <div className="col-span-5 row-span-3">
                <NewsFeedPanel news={NEWS_FEED} onNewsClick={handleNewsSelect} />
              </div>
            </div>
          );
        }

        if (workspace === "lab") {
          return (
            <div className="h-full grid grid-cols-10 grid-rows-6 gap-1.5">
              <div className="col-span-3 row-span-6">
                <QuantumLabPanel markets={MARKETS_DATABASE} />
              </div>
              <div className="col-span-4 row-span-3">
                <MonteCarloPanel market={selectedMarket} />
              </div>
              <div className="col-span-3 row-span-3">
                <ConfluencePanel market={selectedMarket} />
              </div>
              <div className="col-span-4 row-span-3">
                <ModelBreakdownPanel market={selectedMarket} />
              </div>
              <div className="col-span-6 row-span-3">
                <NewsFeedPanel news={NEWS_FEED} onNewsClick={handleNewsSelect} />
              </div>
            </div>
          );
        }

        // scan workspace
        return (
          <div className="h-full grid grid-cols-10 grid-rows-6 gap-1.5">
            <div className="col-span-4 row-span-3">
              <ConfluencePanel market={selectedMarket} />
            </div>
            <div className="col-span-3 row-span-3">
              <MonteCarloPanel market={selectedMarket} />
            </div>
            <div className="col-span-3 row-span-3">
              <ModelBreakdownPanel market={selectedMarket} />
            </div>
            <div className="col-span-5 row-span-3">
              <NewsFeedPanel news={NEWS_FEED} />
            </div>
            <div className="col-span-5 row-span-3">
              <GreeksPanel market={selectedMarket} />
            </div>
          </div>
        );
      };

      return (
        <div className="h-screen flex flex-col">
          {/* Top Bar */}
          <div className="h-7 bg-[#080808] border-b border-gray-800 flex items-center justify-between px-3 flex-shrink-0">
            <div className="flex items-center gap-4">
              <span className="text-orange-500 font-bold text-sm">
                LEET
                <span className="text-white ml-1">QUANTUM</span>
                <span className="text-gray-400 ml-1">
                  TERMINAL
                </span>
                <span className="text-gray-600 text-xs ml-1">
                  PRO
                </span>
              </span>
              <div className="flex">
                {["analysis", "portfolio", "lab", "scan"].map((ws) => (
                  <button
                    key={ws}
                    onClick={() => setWorkspace(ws)}
                    className={`workspace-tab ${
                      workspace === ws ? "active" : ""
                    }`}
                  >
                    {ws}
                  </button>
                ))}
              </div>
              <div className="flex border-l border-gray-800 pl-3 ml-2">
                <button
                  onClick={() => setPlatformFilter("all")}
                  className={`workspace-tab ${platformFilter === "all" ? "active" : ""}`}
                >
                  ALL
                </button>
                <button
                  onClick={() => setPlatformFilter("polymarket")}
                  className={`workspace-tab ${platformFilter === "polymarket" ? "active" : ""}`}
                >
                  POLY
                </button>
                <button
                  onClick={() => setPlatformFilter("kalshi")}
                  className={`workspace-tab ${platformFilter === "kalshi" ? "active" : ""}`}
                >
                  KALSHI
                </button>
              </div>
            </div>
            <div className="flex items-center gap-3 text-xs">
              <span className="text-gray-600">
                Polymarket â¢ Kalshi
              </span>
              <span className="mono text-orange-500">
                {time.toLocaleTimeString()}
              </span>
            </div>
          </div>

          {/* Ticker Tape */}
          <div className="ticker-tape h-5 flex items-center text-xs mono flex-shrink-0">
            <div className="ticker-content">{tickerItems}{tickerItems}</div>
          </div>

          {/* Command Bar */}
          <div className="h-7 bg-[#080808] border-b border-gray-800 flex items-center px-2 gap-2 flex-shrink-0">
            <span className="text-orange-500 text-xs">â¯</span>
            <input
              type="text"
              value={command}
              onChange={(e) => setCommand(e.target.value)}
              onKeyDown={handleCommand}
              placeholder="Enter command or ticker (BTC150K, FEDQ1, GPT5, SCAN, PORT, LAB)..."
              className="cmd-input flex-1 px-2 py-1 text-xs"
            />
            <div className="flex gap-1">
              <button className="btn text-xs">HELP</button>
              <button className="btn text-xs">â</button>
            </div>
          </div>

          {/* MAIN AREA */}
          <div className="flex-1 min-h-0 p-1.5">
            <div className="h-full flex flex-col gap-1.5">
              {/* Top: resizable left/right */}
              <div className="flex-1 min-h-0 flex gap-1.5">
                {/* Left watchlist */}
                <div
                  className="h-full min-w-[140px]"
                  style={{ flex: `0 0 ${leftWidth}px` }}
                >
                  <WatchlistPanel
                    markets={filteredMarkets}
                    selectedId={selectedMarket?.id}
                    onSelect={setSelectedMarket}
                  />
                </div>

                {/* Vertical handle */}
                <div
                  className="split-handle-x"
                  onMouseDown={(e) => startDrag("left", e)}
                />

                {/* Right workspace */}
                <div className="flex-1 min-w-0 h-full">
                  {renderRightGrid()}
                </div>
              </div>

              {/* Horizontal handle */}
              <div
                className="split-handle-y"
                onMouseDown={(e) => startDrag("detail", e)}
              />

              {/* Detail dock */}
              <div
                className="min-h-[80px]"
                style={{ flex: `0 0 ${detailHeight}px` }}
              >
                <MarketDetailDock
                  market={selectedMarket}
                  show={true}
                  onToggle={() => {}}
                />
              </div>
            </div>
          </div>

          {/* Status Bar */}
          <div className="h-5 bg-[#080808] border-t border-gray-800 flex items-center justify-between px-3 text-xs flex-shrink-0">
            <div className="flex items-center gap-4">
              <span className="flex items-center gap-1">
                <span className="w-1.5 h-1.5 rounded-full bg-green-500" />
                <span className="text-gray-600">Connected</span>
              </span>
              <span className="text-gray-600">
                Markets: {MARKETS_DATABASE.length}
              </span>
              <span className="text-gray-600">
                Signals:{" "}
                {
                  MARKETS_DATABASE.filter(
                    (m) => Math.abs(m.model_prob - m.market_prob) > 0.03
                  ).length
                }
              </span>
            </div>
            <div className="flex items-center gap-4">
              <span className="text-yellow-500">
                â  Analysis Only - No Execution
              </span>
              <span className="text-gray-600">v2.0.0</span>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<Terminal />);
  </script>
</body>
</html>
