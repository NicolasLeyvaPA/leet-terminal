FROM node:20-alpine AS builder
WORKDIR /app

# install deps for the frontend
COPY web/package*.json ./web/
RUN cd web && npm ci --production=false

# copy source and build
COPY web/ ./web/
WORKDIR /app/web
RUN npm run build

# Final image: serve static files with nginx
FROM httpd:2.4-alpine AS runner
COPY --from=builder /app/web/dist /usr/local/apache2/htdocs/
EXPOSE 80
